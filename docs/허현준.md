# FastAPI 구조
```
├─app              / 메인 프로젝트 폴더
│  ├─core          / 서비스 모듈
│  ├─model         / 객체 폴더
│  │  ├─common     / DTO에 해당하지 않는 객체 
│  │  ├─request    / request DTO
│  │  └─response   / response DTO
│  └─routers       / 컨트롤러 모듈
├─common           / 공통 API객체, 예외처리 등을 담는 모듈
│  └─exceptions    / 커스텀 예외처리 모듈
├─config           / 환경변수를 불러오는 모듈
├─notebooks        / 주피터노트북 파일들을 모아놓는 폴더
└─utils            / 파일 저장, 삭제, 로그 출력과 같은 도구 모듈
```

## FastAPI에서의 공통 반환 객체
- Spring에서 ApiResponse라는 공통 반환 객체를 사용하자는 이야기가 나와서 FastApi에서도 적용이 가능한지에 대해 탐구했다.
```json
{
    "code": "SU",
    "message": "요청이 성공적으로 처리되었습니다.",
    "object": 반환할객체
}
```
### 응답 모델 정의
- pydantic을 활용하여 입출력 Dto의 형식을 정의할 수 있었다.
```python
class ApiResponse(BaseModel):
    code: str
    message: str
    object: Optional[Any] = None
```

### 응답 타입
- 응답의 code, message를 미리 정의하기 위한 Enum이다.
- 각 에러마다 여기서 에러메세지와 에러코드를 정의할 수 있다.
```python
# Response 상태 Enum 정의
class ResponseType(Enum):
    SUCCESS = ("SU", 200, "요청이 성공적으로 처리되었습니다.")
    NOT_FOUND_PAGE = ("NP", 404, "페이지를 찾을 수 없습니다.")
    # 추가 에러 타입을 여기서 정의하세요.

    def __init__(self, code: str, status_code: int, message: str):
        self.code = code
        self.status_code = status_code
        self.message = message
```

### 예외 처리
- 예외처리가 가장 까다로웠는데, Spring에서도 공통응답객체로 응답하는데에는 성공했으나, HTTPstatus가 200으로 통일되는 문제가 있었다. 그래서 Fastapi에서도 비슷한 결의 문제가 발생하지 않게 하기위해
- CustomException class를 만들고, ResponseType을 반환하도록 제작한 후 Exception handler를 추가했다.
```python
class CustomException(Exception):
    def __init__(self, response_type: ResponseType, detail: Optional[str] = None):
        self.response_type = response_type
        # detail이 제공되지 않으면 ResponseType의 기본 메시지를 사용합니다.
        self.detail = detail or response_type.message
```

```python
@app.exception_handler(CustomException)
async def custom_exception_handler(request: Request, exc: CustomException):
    error_status = exc.response_type
    return JSONResponse(
        status_code=error_status.status_code,
        content={
            "code": error_status.code,
            "message": exc.detail,
            "object": None
        }
    )
```














